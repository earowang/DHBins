<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Categorical data using triangles • DHBins</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Categorical data using triangles">
<meta property="og:description" content="DHBins">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DHBins</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/halfhex.html">Halfhexes for population rates</a>
    </li>
    <li>
      <a href="../articles/triangles.html">Categorical data using triangles</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Categorical data using triangles</h1>
                        <h4 class="author">Thomas Lumley</h4>
            
            <h4 class="date">2020-06-29</h4>
      
      
      <div class="hidden name"><code>triangles.Rmd</code></div>

    </div>

    
    
<p>Size and shading allow a single value to be displayed for each area unit. In order to display categorical data, we divide each hex into six triangles and aim to assign <span class="math inline">\([6p]\)</span> triangles to a category with proportion <span class="math inline">\(p\)</span> of the total. Simply rounding <span class="math inline">\(6p\)</span> to the nearest integer does not guarantee that the number of triangles assigned will add up to six; we use the Webster/Saint-Laguë algorithm to allocate exactly six triangles. This is the same idea as used for hexbin scatterplots in the <code>hextri</code> package.</p>
<p>These triangle maps are superficially related to pie charts, but they do not share the deficiencies of pie charts. The standard objection to pie charts is the difficulty of judging angles; in these triangle maps the angles are discrete and the number of possibilities is small, so counting triangles is fast and reliable. Conversely, an important limitation of the triangular subdivisions is their discreteness: they cannot display a category with probability 1/12th or less. More generally, they will be biased according to whether the category proportion is rounded up or down.</p>
<p>We have</p>
<ul>
<li>a function <code><a href="../reference/tri_alloc.html">tri_alloc()</a></code> for allocating triangles based on category counts</li>
<li>base-R functions <code>dhbtri()</code> and <code><a href="../reference/dhbin.html">regiontri()</a></code>
</li>
<li>ggplot2 functions <code>geom_dhb_tri</code> and <code>geom_region_tri()</code>
</li>
</ul>
<p>The base-R functions work on <em>wide</em> format data, with a six-column matrix giving the triangle assignments. The <code>ggplot2</code> geoms work on <em>long</em> format data, with a single column of colours and an identifier to map them to triangles.</p>
<div id="car-ownership-by-dhb" class="section level3">
<h3 class="hasAnchor">
<a href="#car-ownership-by-dhb" class="anchor"></a>Car ownership by DHB</h3>
<p>We have data on car ownership in the District Health Board areas, from Stats New Zealand.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">DHBins</span>)</pre></body></html></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">dhb_cars</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">dhb_cars</span>)</pre></body></html></div>
<pre><code>##                dhb  none   one   two  more
## 1        Northland  4077 22161 20652  7407
## 2        Waitemata  8658 57492 72768 33219
## 3         Auckland 16752 54840 52113 20340
## 4 Counties Manukau  8214 40344 53991 29022
## 5          Waikato  9168 48396 49401 20016
## 6            Lakes  2820 13647 13020  4968</code></pre>
<p>The first step is to allocate triangles</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">tris</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/tri_alloc.html">tri_alloc</a></span>(<span class="no">dhb_cars</span>[,-<span class="fl">1</span>], <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"0"</span>,<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3+"</span>), <span class="kw">names</span><span class="kw">=</span><span class="no">dhb_cars</span>$<span class="no">dhb</span> )
<span class="no">tri_data</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">DHB</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">tris</span>),<span class="fl">6</span>),
                     <span class="kw">cars</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="no">tris</span>),
             <span class="kw">tri_id</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fl">6</span>,<span class="kw">each</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">tris</span>)))
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">tris</span>)</pre></body></html></div>
<pre><code>##                  [,1] [,2] [,3] [,4] [,5] [,6]
## Northland        "1"  "1"  "1"  "2"  "2"  "3+"
## Waitemata        "1"  "1"  "2"  "2"  "2"  "3+"
## Auckland         "0"  "1"  "1"  "2"  "2"  "3+"
## Counties Manukau "1"  "1"  "2"  "2"  "2"  "3+"
## Waikato          "1"  "1"  "2"  "2"  "2"  "3+"
## Lakes            "0"  "1"  "1"  "2"  "2"  "3+"</code></pre>
<p>Now use <code>ggplot</code> to</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">tri_data</span>)+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">DHB</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">tri_id</span>, <span class="kw">fill</span><span class="kw">=</span><span class="no">cars</span>),<span class="kw">alpha</span><span class="kw">=</span><span class="fl">0.5</span>)+
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span>()+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_label_dhb</a></span>(<span class="kw">short</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">4</span>)</pre></body></html></div>
<p><img src="triangles_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
</div>
<div id="ethnicity-by-region" class="section level3">
<h3 class="hasAnchor">
<a href="#ethnicity-by-region" class="anchor"></a>Ethnicity by Region</h3>
<p>The data on ethnicity come from the Census, now for the Regions. For the benefit of non-NZ people, the “MELAA” group is Middle East, Latin America, and Africa“, essentially,”Other“.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">region_ethnicity</span>)
<span class="no">tri_eth</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/tri_alloc.html">tri_alloc</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">region_ethnicity</span>[,-<span class="fl">1</span>]),
    <span class="kw">classes</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Asian"</span>,<span class="st">"Euro"</span>,<span class="st">"Maori"</span>,<span class="st">"MELAA"</span>,<span class="st">"Pacific"</span>),
    <span class="kw">names</span><span class="kw">=</span><span class="no">region_ethnicity</span>$<span class="no">Area</span>)


<span class="no">tri_data</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">Region</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">tri_eth</span>),<span class="fl">6</span>),
                     <span class="kw">ethnicity</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="no">tri_eth</span>),
             <span class="kw">tri_id</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fl">6</span>,<span class="kw">each</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">tri_eth</span>)))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">tri_data</span>)+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_regiontri</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">Region</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">tri_id</span>, <span class="kw">fill</span><span class="kw">=</span><span class="no">ethnicity</span>))+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_label_region</a></span>(<span class="kw">colour</span><span class="kw">=</span><span class="st">"Black"</span>, <span class="kw">short</span><span class="kw">=</span><span class="fl">TRUE</span>,<span class="kw">cex</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<p><img src="triangles_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Thomas Lumley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
