<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Halfhexes for population rates • DHBins</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Halfhexes for population rates">
<meta property="og:description" content="DHBins">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DHBins</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/halfhex.html">Halfhexes for population rates</a>
    </li>
    <li>
      <a href="../articles/triangles.html">Categorical data using triangles</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Halfhexes for population rates</h1>
                        <h4 class="author">Thomas Lumley</h4>
            
            <h4 class="date">2020-06-28</h4>
      
      
      <div class="hidden name"><code>halfhex.Rmd</code></div>

    </div>

    
    
<p>Another use of triangular subdivision is to show counts and population sizes, as an alternative to just showing <em>per capita</em> rates. The use of <em>per capita</em> figures has been controversial in the COVID pandemic, because the natural size distribution of a cluster does not really depend on the size of the host population.</p>
<p>The NZ Ministry of Health has been releasing information about COVID-19 cases, and Chris Knox (of the NZ Herald) has been collating it on <a href="https://github.com/nzherald/nz-covid19-data">github</a>. These data are from late March 2020.</p>
<p>Here, I’m going to map it by District Health Board. First, load the data</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">DHBins</span>)</pre></body></html></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## Warning: package 'ggplot2' was built under R version 3.6.2</code></pre>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">nzcovid</span>)</pre></body></html></div>
<p>Next, we need population data. That’s also in the package</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">dhb_cars</span>)

<span class="no">popsize</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">dhb</span><span class="kw">=</span><span class="no">dhb_cars</span>$<span class="no">dhb</span>, <span class="kw">Total</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">dhb_cars</span>[,-<span class="fl">1</span>]))</pre></body></html></div>
<p>I’m going to do a split hex map where there’s a hex for each District Health Board, with half of the hex showing the population and the other half showing the number of cases. That means I need to divide each hex into six triangles, and use three for population and the other three for number of cases. Actually, I need two superimposed hexes for each District Health Board, because you can’t vary the radius of a triangulated hex. Half of each hex will be <code>NA</code>.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">pop_tri</span><span class="kw">&lt;-</span><span class="no">popsize</span>[<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">popsize</span>),<span class="kw">each</span><span class="kw">=</span><span class="fl">6</span>),]
<span class="no">pop_tri</span>$<span class="no">group</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"blank"</span>,<span class="st">"Population"</span>),<span class="kw">each</span><span class="kw">=</span><span class="fl">3</span>),<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">popsize</span>))
<span class="no">pop_tri</span>$<span class="no">order</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>),<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">popsize</span>))


<span class="no">case_tri</span><span class="kw">&lt;-</span><span class="no">case_r</span>[<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">case_r</span>),<span class="kw">each</span><span class="kw">=</span><span class="fl">6</span>),]
<span class="no">case_tri</span>$<span class="no">group</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Cases"</span>,<span class="st">"empty"</span>),<span class="kw">each</span><span class="kw">=</span><span class="fl">3</span>),<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">case_r</span>))
<span class="no">case_tri</span>$<span class="no">order</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>),<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">case_r</span>))</pre></body></html></div>
<p>Now, assemble the plot. First, an outline for each hex</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">case_tri</span>)+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhb</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">popsize</span>, <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>),<span class="kw">fill</span><span class="kw">=</span><span class="st">"grey98"</span>)</pre></body></html></div>
<p><img src="halfhex_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>Now, add the population sizes</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">case_tri</span>)+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhb</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">popsize</span>, <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>),<span class="kw">fill</span><span class="kw">=</span><span class="st">"grey98"</span>)+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">pop_tri</span>,<span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>,<span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">Total</span>)),
              <span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="halfhex_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>But we need to suppress half of that</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">case_tri</span>)+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhb</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">popsize</span>, <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>),<span class="kw">fill</span><span class="kw">=</span><span class="st">"grey98"</span>)+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">pop_tri</span>,<span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>,<span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">Total</span>)),
              <span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)+
  <span class="fu">scale_fill_manual</span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">blank</span><span class="kw">=</span><span class="fl">NA</span>,<span class="kw">Population</span><span class="kw">=</span><span class="st">"forestgreen"</span>,<span class="kw">Cases</span><span class="kw">=</span><span class="st">"gold"</span>,<span class="kw">empty</span><span class="kw">=</span><span class="fl">NA</span>))</pre></body></html></div>
<p><img src="halfhex_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>Now, do the same thing with the case data</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">case_tri</span>)+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhb</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">popsize</span>, <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>),<span class="kw">fill</span><span class="kw">=</span><span class="st">"grey98"</span>)+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">pop_tri</span>,<span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>,<span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">Total</span>)),
              <span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)+
  <span class="fu">scale_fill_manual</span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">blank</span><span class="kw">=</span><span class="fl">NA</span>,<span class="kw">Population</span><span class="kw">=</span><span class="st">"forestgreen"</span>,<span class="kw">Cases</span><span class="kw">=</span><span class="st">"gold"</span>,<span class="kw">empty</span><span class="kw">=</span><span class="fl">NA</span>))+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">case_tri</span>, <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">DHB</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>,<span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">Count</span>)),
              <span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="halfhex_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<p>And add abbrevations for each District Health Board, offsetting them up so they don’t obscure the data</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">case_tri</span>)+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhb</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">popsize</span>, <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>),<span class="kw">fill</span><span class="kw">=</span><span class="st">"grey98"</span>)+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">pop_tri</span>,<span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>,<span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">Total</span>)),
              <span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)+
  <span class="fu">scale_fill_manual</span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">blank</span><span class="kw">=</span><span class="fl">NA</span>,<span class="kw">Population</span><span class="kw">=</span><span class="st">"forestgreen"</span>,<span class="kw">Cases</span><span class="kw">=</span><span class="st">"gold"</span>,<span class="kw">empty</span><span class="kw">=</span><span class="fl">NA</span>))+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">case_tri</span>, <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">DHB</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>,<span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">Count</span>)),
              <span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)+
  <span class="fu"><a href="../reference/geom_dhb.html">geom_label_dhb</a></span>(<span class="kw">short</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">position</span><span class="kw">=</span><span class="fu">position_nudge</span>(<span class="kw">x</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">y</span><span class="kw">=</span><span class="fl">0.5</span>),<span class="kw">col</span><span class="kw">=</span><span class="st">"grey50"</span>,<span class="kw">size</span><span class="kw">=</span><span class="fl">2.5</span>)</pre></body></html></div>
<p><img src="halfhex_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<p>It looks as though rural areas are at lower risk, but so is Canterbury (about 80% of which is Christchurch). We might want to put confidence intervals on, to see if these differences are larger than you’d get from random variation. It’s easy to model the purely random part of this with a Poisson distribution, but we don’t have data on ascertainment rates so the variation will be underestimated.</p>
<p>I used <code><a href="https://rdrr.io/r/stats/poisson.test.html">poisson.test()</a></code> to compute exact confidence intervals for the rates, since the counts in some areas are (happily) very small.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">case_tri</span>$<span class="no">low</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">case_tri</span>$<span class="no">Count</span>, <span class="kw">function</span>(<span class="no">n</span>) <span class="fu"><a href="https://rdrr.io/r/stats/poisson.test.html">poisson.test</a></span>(<span class="no">n</span>)$<span class="no">conf.int</span>[<span class="fl">1</span>])
<span class="no">case_tri</span>$<span class="no">high</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">case_tri</span>$<span class="no">Count</span>, <span class="kw">function</span>(<span class="no">n</span>) <span class="fu"><a href="https://rdrr.io/r/stats/poisson.test.html">poisson.test</a></span>(<span class="no">n</span>)$<span class="no">conf.int</span>[<span class="fl">2</span>])

<span class="no">case_tri</span>$<span class="no">total_scaled</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">case_tri</span>, <span class="fl">0.95</span>*<span class="no">Count</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">high</span>))
<span class="no">case_tri</span>$<span class="no">low_scaled</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">case_tri</span>, <span class="fl">0.95</span>*<span class="no">low</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">high</span>))
<span class="no">case_tri</span>$<span class="no">high_scaled</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">case_tri</span>, <span class="fl">0.95</span>*<span class="no">high</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">high</span>))</pre></body></html></div>
<p>Also, I want the population half of the hex scaled to match the true count, not the outer confidence limit</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">pop_tri</span>$<span class="no">total_scaled</span><span class="kw">&lt;-</span> <span class="fl">0.95</span>*<span class="no">pop_tri</span>$<span class="no">Total</span>*<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">case_tri</span>$<span class="no">total_scaled</span>)/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">pop_tri</span>$<span class="no">Total</span>)</pre></body></html></div>
<p>And finally, we can assemble it. First, the population half</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">case_tri</span>)+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_dhb</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">popsize</span>, <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>),<span class="kw">fill</span><span class="kw">=</span><span class="st">"grey98"</span>)+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">pop_tri</span>,
                <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>,<span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">total_scaled</span>)),
                <span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)+
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">blank</span><span class="kw">=</span><span class="fl">NA</span>,<span class="kw">Population</span><span class="kw">=</span><span class="st">"forestgreen"</span>,<span class="kw">Cases</span><span class="kw">=</span><span class="st">"magenta"</span>,<span class="kw">empty</span><span class="kw">=</span><span class="fl">NA</span>))</pre></body></html></div>
<p><img src="halfhex_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>Now add the case half in three, partially transparent, sections: the upper limit, the observed value, then the lower limit</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">case_tri</span>)+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_dhb</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">popsize</span>, <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>),<span class="kw">fill</span><span class="kw">=</span><span class="st">"grey98"</span>)+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">pop_tri</span>,
                <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">dhb</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>,<span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">total_scaled</span>)),
                <span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)+
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">blank</span><span class="kw">=</span><span class="fl">NA</span>,<span class="kw">Population</span><span class="kw">=</span><span class="st">"forestgreen"</span>,<span class="kw">Cases</span><span class="kw">=</span><span class="st">"magenta"</span>,<span class="kw">empty</span><span class="kw">=</span><span class="fl">NA</span>))+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">case_tri</span>,
                <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">DHB</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>,<span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">high_scaled</span>)),
                <span class="kw">alpha</span><span class="kw">=</span><span class="fl">0.1</span>,<span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_label_dhb</a></span>(<span class="kw">short</span><span class="kw">=</span><span class="fl">TRUE</span>,<span class="kw">position</span><span class="kw">=</span><span class="fu">position_nudge</span>(<span class="kw">x</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">y</span><span class="kw">=</span><span class="fl">0.5</span>),
                   <span class="kw">col</span><span class="kw">=</span><span class="st">"grey50"</span>,<span class="kw">size</span><span class="kw">=</span><span class="fl">3</span>)+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">case_tri</span>,
                <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">DHB</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>, <span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>, <span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">total_scaled</span>)),
                <span class="kw">alpha</span><span class="kw">=</span><span class="fl">0.3</span>,<span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)+
    <span class="fu"><a href="../reference/geom_dhb.html">geom_dhbtri</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">case_tri</span>,
                <span class="fu">aes</span>(<span class="kw">map_id</span><span class="kw">=</span><span class="no">DHB</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">group</span>,<span class="kw">class_id</span><span class="kw">=</span><span class="no">order</span>,<span class="kw">radius</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">low_scaled</span>)),
                <span class="kw">alpha</span><span class="kw">=</span><span class="fl">0.3</span>,<span class="kw">coord</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">show.legend</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="halfhex_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>Most of the variation between DHBs can be explained by population size and Poisson variability. For example, we can see that Tairāwhiti DHB, at the top right of the North Island, had zero cases and so has no inner or middle hex. Its outer hex is a good match for population size, indicating that the rate of cases is not significantly low. On the other hand, Canterbury DHB, on the east of the South Island, had fewer cases than would be expected.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Thomas Lumley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
